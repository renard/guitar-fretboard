%%

%% Copyright © 2018 by Sébastien Gross <seb -at- chezwam -dot- org>

%% This program is free software. It comes without any warranty, to the extent
%% permitted by applicable law. You can redistribute it and/or modify it under
%% the terms of the Do What The Fuck You Want To Public License, Version 2, as
%% published by Sam Hocevar. See http://sam.zoy.org/wtfpl/COPYING for more
%% details.

%% This file may be distributed and/or modified under the conditions of
%% the LaTeX Project Public License, either version 1.3c of this license
%% or (at your option) any later version. The latest version of this
%% license is in:

%% http://www.latex-project.org/lppl.txt

%% and version 1.3c or later is part of all distributions of LaTeX
%% version 2006/05/20 or later.

\RequirePackage{xcolor}
\RequirePackage{pgfkeys}

\newif\iffb@color@derive
\pgfkeys{
  /fb/colors/.cd,
  limit/.initial = 0.5,
  model/.initial = HTML,
  derive/.is if = fb@color@derive,
  derive = false,
}

%% #1 /fb/colors
%% #2 color index
%% #3 color definition
\newcommand{\setcolor}[3][]{
  \pgfkeys{/fb/colors/.cd,
    derive = false,
    #1}
  \iffb@color@derive%
  \colorlet{bg#2}{#3}
  \else
  \definecolor{bg#2}{\pgfkeysvalueof{/fb/colors/model}}{#3}
  \fi

  % Compute foreground
  %% https://tex.stackexchange.com/questions/379893
  \extractcolorspecs{bg#2}{\modelspec}{\grayscale}
  \pgfmathparse{(
    array({\grayscale},0)*0.2126+
    array({\grayscale},1)*0.7152+
    array({\grayscale},2)*0.0722)>=\pgfkeysvalueof{/fb/colors/limit}?int(1):int(0)}
  \ifnum\pgfmathresult>0%
  \colorlet{fg#2}{black}
  \else % Less bright
  \colorlet{fg#2}{white}
  \fi
}


\setcolor{1}{000000}      
\setcolor[derive]{1b} {bg1!10}
\setcolor[derive]{1bb}{bg1b!10}
\setcolor[derive]{1s} {bg1!10}
\setcolor[derive]{1ss}{bg1s!10}


\setcolor{2}{377EB8}
\setcolor[derive]{2b} {bg2!70!black}
\setcolor[derive]{2bb}{bg2b!70!black}
\setcolor[derive]{2s} {bg2!30!white}
\setcolor[derive]{2ss}{bg2s!30!white}

\setcolor[limit=0.59]{3}{4DAF4A}
\setcolor[derive]{3b} {bg3!70!black}
\setcolor[derive]{3bb}{bg3b!70!black}
\setcolor[derive]{3s} {bg3!30!white}
\setcolor[derive]{3ss}{bg3s!30!white}

\setcolor{4}{984EA3}
\setcolor[derive]{4b} {bg4!70!black}
\setcolor[derive]{4bb}{bg4b!70!black}
\setcolor[derive]{4s} {bg4!30!white}
\setcolor[derive]{4ss}{bg4s!30!white}

\setcolor{5}{E41A1C}
\setcolor[derive]{5b} {bg5!70!black}
\setcolor[derive]{5bb}{bg5b!70!black}
\setcolor[derive]{5s} {bg5!30!white}
\setcolor[derive]{5ss}{bg5s!30!white}

\setcolor{6}{FFFF33}
\setcolor[derive]{6b} {bg6!70!black}
\setcolor[derive]{6bb}{bg6b!70!black}
\setcolor[derive]{6s} {bg6!30!white}
\setcolor[derive]{6ss}{bg6s!30!white}

\setcolor{7}{A65628}
\setcolor[derive]{7b} {bg7!70!black}
\setcolor[derive]{7bb}{bg7b!70!black}
\setcolor[derive]{7s} {bg7!30!white}
\setcolor[derive]{7ss}{bg7s!30!white}
